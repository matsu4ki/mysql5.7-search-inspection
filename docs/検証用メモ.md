# 実施手順

## 1. データ準備

`./setup.sh`を起動してデータを準備する。
`aria2`を利用してDLしているので、`aria2`を用意すること。

- https://aria2.github.io/
- https://qiita.com/TokyoMickey/items/cb51805a19dcee416151

## 2. MySQLサーバの起動

`docker-compose up -d`で各DBを起動する。

## 3. MySQLサーバとの接続

`docker-compose.yml`内の記述情報を元に、各DBへCLI/GUIを用いてDBに接続する

## 4. 値の追加

検索結果を同じにするため、検索結果の行が1つになるような文字列をpageテーブルに追加する。

```sql
INSERT INTO page (page_namespace, page_title, page_restrictions, page_is_redirect, page_is_new,
                               page_random, page_touched, page_links_updated, page_latest, page_len, page_content_model,
                               page_lang)
VALUES (3, 'hogefugapiyofoobar', '', 0, 0, 0.383650567779, 0x3230323131303233303332303438, null, 14912975,
        5207, 0x77696B6974657874, null);
```

## 5. MySQLのコンテナサイズを確認

`docker ps -s`にて、容量を確認する。



## 6. like文の速度測定

以下を実施し、速度を測る

```sql
select page_title from page where page_title like '%hogefugafoobar%';
```



## 7. 全文検索時の速度測定

### a. 利用可能になっているかの確認

Nameカラムにngramがあるので、そのレコードのStatusがACTIVEになっていればOK

```sql
SHOW plugins;
```

### b. bigramへの変更

```sql
SHOW GLOBAL VARIABLES  LIKE 'innodb_ft_min_token_size';
```
の数がデフォルトだと3なので、
```sql
SET GLOBAL innodb_ft_min_token_size = 2;
```
で2に変更する。

### c. インデックスを作成する

```sql
ALTER TABLE page ADD FULLTEXT INDEX full_text_index_on_page_title (page_title) WITH PARSER ngram;
```

### d. インデックスの容量を測る

`docker ps -s`にて、容量を確認する。

### e. 速度測定

以下を実施し、速度を測る

```sql
SELECT page_title FROM page WHERE MATCH(`page_title`) AGAINST ('hogefugafoobar' IN BOOLEAN MODE);
```